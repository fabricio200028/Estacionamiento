<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Estacionamiento</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <h1>Gestión de Estacionamiento</h1>

    <!-- Formulario para registrar la entrada de un vehículo -->
    <section>
        <h2>Registrar Entrada de Vehículo</h2>
        <form action="/entrada" method="POST">
            <div>
                <label for="matricula">Matrícula:</label>
                <input type="text" id="matricula" name="matricula" required>
            </div>
            <div>
                <label for="tipo_vehiculo">Tipo de Vehículo:</label>
                <select id="tipo_vehiculo" name="tipo_vehiculo" required>
                    <option value="">Seleccionar</option>
                    <% tarifas.forEach(function(tarifa) { %>
                        <option value="<%= tarifa.tipo_vehiculo %>"><%= tarifa.tipo_vehiculo %></option>
                    <% }); %>
                </select>
            </div>
            <div>
                <label for="nombre_propietario">Nombre del Propietario:</label>
                <input type="text" id="nombre_propietario" name="nombre_propietario" required>
            </div>
            <div>
                <label for="espacio_id">Espacio de Estacionamiento:</label>
                <select id="espacio_id" name="espacio_id" required>
                    <option value="">Seleccionar</option>
                    <% espaciosDisponibles.forEach(function(espacio) { %>
                        <option value="<%= espacio.espacio_id %>"><%= espacio.numero_espacio %></option>
                    <% }); %>
                </select>
            </div>
            <button type="submit">Registrar Entrada</button>
        </form>
    </section>

    <!-- Formulario para registrar la salida de un vehículo -->
    <section>
        <h2>Registrar Salida de Vehículo</h2>
        <form action="/salida" method="POST">
            <div>
                <label for="matricula_salida">Matrícula:</label>
                <input type="text" id="matricula_salida" name="matricula" required>
            </div>
            <button type="submit">Registrar Salida</button>
        </form>
    </section>

    <!-- Visualización de la disponibilidad de espacios -->
    <section>
        <h2>Disponibilidad de Espacios</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Número de Espacio</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                <% espaciosEstacionamiento.forEach(function(espacio) { %>
                    <tr>
                        <td><%= espacio.numero_espacio %></td>
                        <td><%= espacio.estado %></td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </section>

    <!-- Historial de movimientos de un vehículo -->
    <section>
        <h2>Historial de Movimientos</h2>
        <form action="/historial" method="GET">
            <div>
                <label for="matricula_historial">Matrícula:</label>
                <input type="text" id="matricula_historial" name="matricula" required>
            </div>
            <button type="submit">Ver Historial</button>
        </form>

        <% if (historialMovimientos && historialMovimientos.length > 0) { %>
            <h3>Movimientos para la matrícula: <%= historialMatricula %></h3>
            <table border="1">
                <thead>
                    <tr>
                        <th>Entrada</th>
                        <th>Salida</th>
                        <th>Espacio</th>
                        <th>Costo</th>
                    </tr>
                </thead>
                <tbody>
                    <% historialMovimientos.forEach(function(movimiento) { %>
                        <tr>
                            <td><%= movimiento.entrada %></td>
                            <td><%= movimiento.salida || 'En estacionamiento' %></td>
                            <td><%= movimiento.numero_espacio %></td>
                            <td><%= movimiento.costo ? '$' + movimiento.costo : '-' %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        <% } else if (typeof historialMovimientos !== 'undefined') { %>
            <p>No se encontraron movimientos para la matrícula ingresada.</p>
        <% } %>
    </section>

</body>
</html>
